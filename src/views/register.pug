extends layout

block content
  .form-container
    h2 Criar Conta
    form#registerForm
      .form-group
        label(for="nome") Nome Completo
        input(type="text" id="nome" name="nome" required)
      .form-group
        label(for="email") E-mail
        input(type="email" id="email" name="email" required)
      .form-group
        label(for="senha") Senha
        input(type="password" id="senha" name="senha" required minlength="6")
      
      button.btn(type="submit") Cadastrar
      p.error-msg#errorMsg Erro ao cadastrar

  script.
    document.getElementById('registerForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const nome = document.getElementById('nome').value;
      const email = document.getElementById('email').value;
      const senha = document.getElementById('senha').value;

      try {
        const res = await fetch('/api/auth/registro', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ nome, email, senha })
        });

        const data = await res.json();

        if (res.ok) {
          alert('Cadastro realizado com sucesso! Fa√ßa login.');
          window.location.href = '/login';
        } else {
          document.getElementById('errorMsg').textContent = data.erro || 'Erro ao cadastrar';
          document.getElementById('errorMsg').style.display = 'block';
        }
      } catch (err) {
        console.error(err);
      }
    });
